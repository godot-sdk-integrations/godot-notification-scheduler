#
# Â© 2024-present https://github.com/cengiz-pz
#

source 'https://github.com/CocoaPods/Specs.git'
use_frameworks!

# Manually parse config.properties
properties = {}
begin
	File.foreach('config/config.properties') do |line|
	# Skip comments and empty lines
	line = line.strip
	next if line.empty? || line.start_with?('#', '!')
	# Split on the first '=' to handle values containing '='
	key, value = line.split('=', 2).map(&:strip)
	properties[key] = value if key && value
end
rescue Errno::ENOENT
	puts "Error: config/config.properties not found. Podfile cannot proceed without configuration."
	exit 1
end

plugin_name = "#{properties['plugin_node_name']}Plugin"

project "#{plugin_name}.xcodeproj"
workspace "./#{plugin_name}.xcodeproj/project.xcworkspace"

# Extract dependencies (assuming a comma-separated list of name:version pairs)
deps = properties['dependencies']&.split(',')&.map(&:strip) || []

target "#{plugin_name}" do
	platform :ios, properties[:platform_version] || '14.3'

	# Install each dependency with its version
	deps.each do |dep|
		next if dep.empty?
		name, version = dep.split(':').map(&:strip)
		if name && version
			pod name, version
		else
			puts "Warning: Skipping invalid dependency format: #{dep}"
		end
	end
end
